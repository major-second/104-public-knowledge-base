- 最小二乘法：使$\sum (y_i-(a+bx_i))^2$最小
- 记号：$\hat a,\hat b$是估计值，$\hat y = \hat a+\hat bx$是所求经验公式
  - 恒成立的：$\bar y = \hat a + \hat b \bar x$
  - 记$l_{xy}=\sum (x_i-\bar x)(y_i-\bar y)$，同理$l_{xx},l_{yy}$
    - 参考[[variance]]中的处理手法，还可以写成$l_{xy}=\sum x_iy_i -n\bar x\bar y$
    - 其实这里的$l_{xx}$就是[[variance]]的$n$倍嘛，$l_{xy}$对应[[cov]]
- 公式：$\hat b = \frac{\sum(x_i-\bar x)(y_i-\bar y)}{\sum (x_i-\bar x)^2}=l_{xy}/l_{xx}$
  - 当然有$\hat y_i - \bar y = \hat b(x_i-\bar x)$，这对后面拆平方和有作用
  - 其和[[variance]]，[[cov]]当然有联系：就是协方差除以方差
## 三个平方和
- 参考 https://www.zhihu.com/question/403268066/answer/1301103401
- 三个平方和
  - 总平方和，$TSS$，total sum of squares

  - 残差平方和，$RSS$，residual sum of squares
  - 回归平方和，$ESS$，explained sum of squares
- 对于给定数据集，总平方和$l_{yy}=\sum (y_i-\bar y)^2$为常量
  - 特别注意“总平方和”并不是$\sum y_i^2$！！！
- 对于OLS，其可拆成两部分
  - $RSS=Q=\sum (y_i-\hat y_i)^2$
  - $ESS=U=\sum (\hat y_i - \bar y)^2$
- 证明可拆
  - 把交叉项往$l$记号上凑
  - 即：$y_i-\hat y_i = y_i - bx_i-a=y_i-\bar y+\bar y -bx_i-a=y_i-\bar y +b\bar x-bx_i$，这样就都表示成了$x_i-\bar x$和$y_i-\bar y$
  - 能拆成两部分的条件
    - $(y_i-\bar y)(b\bar x-bx_i)$求和为0
    - 也就是某两个东西无关
    - in sample一定成立，out of sample未必成立
- 希望第一部分$Q$残差平方和小，第二部分$U$回归平方和大
## $R^2$
- $R^2=1-\frac{残差平方和}{总平方和} \le 1$
  - **不一定要用线性模型，也不一定用最小二乘法**
  - 如果有训练集，有测试集，那么过拟合则可出现$R^2$为负数，即“效果不如取平均值”
  - OLS：$U/l_{yy}$**此时恰好是**$R^2$，反映拟合优度
    - 此时$R^2=\frac{回归平方和}{总平方和}$
  - 注意$\frac{回归平方和}{总平方和}$并不一定是$R^2$
    - 你如果把$\frac{回归平方和}{总平方和}$定义成$R^2$，测试集out of sample的$R^2$就有可能大于1了
## 其它内容
- 由于$b=0$时$\frac{U}{Q/(n-2)}\sim F(1,n-2)$，故可以用$F:=\frac{U}{Q/(n-2)}=\frac{\hat b l_{xy}}{(l_{yy}-U)/(n-2)}$在[[f]]分布中处于多少分位数做假设检验
  - 回忆：[[UMP]]提到了我们要考虑零假设成立时某统计量的分布
  - $F$大则容易否定假设
- 相关系数[[cov#corr]]
  - $r=\frac{l_{xy}}{\sqrt{l_{xx}l_{yy}}}$，$r^2=\hat bl_{xy}/l_{yy}=U/l_{yy}$
  - 和刚刚[[unary#$R^2$]]能联系上
  - $F$可以用$r$表示，所以可以计算$r$，再计算$F$再检验
- 备注：此处零假设除了$b=0$，还有残差$e$独立同分布且正态。检验这个是另一个问
- 预测：对随机变量估计，不是对参数估计
  - 但也有类比[[2-estimation]]的区间估计
  - 这里的置信区间含义就是以多少概率在什么区间之内，和[[区间估计的误区]]完全不同
  - 例如课本上说一定条件下某个量满足$t$分布，然后就可以类比[[枢轴量方法]]写出置信区间
- 控制：有了置信区间表达式，可以解不等式，从而以$1-\alpha$概率使$y_0$落在某个$[A,B]$内
- 齐次情形：$\hat b = \sum x_iy_i/\sum x_i^2$
  - 回忆零假设，此时$y_i$独立同分布正态，回忆[[f]]，就容易找到$F=\frac{n\bar y^2}{\sum(y_i-\bar y)^2/(n-1)}\sim F(1,n-1)$